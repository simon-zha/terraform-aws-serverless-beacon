# # .github/workflows/deploy-staging.yml
# name: Deploy Staging Environment

# Staging and Hotfix branch only allow merge
# on:
#   push:
#     branches:
#       - 'release/**'
#       - 'hotfix/**'
# jobs:
#   terraform_deploy_staging:
#     runs-on: ubuntu-latest
#     environment: staging
#     steps:
#     - name: Checkout Code
#       uses: actions/checkout@v4
#     # in progress
#     - name: Configure AWS Credentials 
#     - name: Setup Terraform
#       uses: hashicorp/setup-terraform@v3
#     - name: Docker build
#     - name: Docker push
#     - name: Deploy to dev environment
#
#     # Example: capture and upload api_url after successful terraform apply
#     # Uncomment and adapt below to enable automatic post-deploy artifact upload
#     #      - name: Capture API URL (post-deploy)
#     #        if: env.TF_APPLY_FLAG == 'true'
#     #        run: |
#     #          set -euo pipefail
#     #          echo "Retrieving api_url from terraform outputs..."
#     #          if terraform -chdir=${{ env.TF_WORKING_DIR }} output -raw api_url > post_deploy_info.txt 2>/dev/null; then
#     #            echo "Captured api_url"
#     #          else
#     #            echo "Falling back to json output parsing"
#     #            terraform -chdir=${{ env.TF_WORKING_DIR }} output -json api_url | python -c "import sys, json; print(json.load(sys.stdin))" > post_deploy_info.txt
#     #          fi
#     #
#     #      - name: Upload post-deploy info
#     #        if: env.TF_APPLY_FLAG == 'true'
#     #        uses: actions/upload-artifact@v4
#     #        with:
#     #          name: post-deploy-info-${{ github.run_id }}
#     #          path: post_deploy_info.txt

